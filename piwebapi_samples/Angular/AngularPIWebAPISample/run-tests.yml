steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '10.x'
    displayName: 'Specify Node version'
  
  # This should really be split up into multiple steps
  - script: |
      echo Install Angular CLI
      call npm install -g @angular/cli
      echo NPM CI
      call npm ci
      echo Run tests
      call ng test --watch=false
      echo Complete
    workingDirectory: $(Build.SourcesDirectory)/piwebapi_samples/Angular/AngularPIWebAPISample
    displayName: 'Run tests'
  
  - task: PublishTestResults@2
    condition: succeededOrFailed()
    inputs:
      testRunner: JUnit
      testResultsFiles: '**/TESTS-*.xml'
    displayName: 'Publish test results'
